----------[INFO] Starting COMBINED deviation analysis (all volume types together)
----------[INFO] Model directory: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TRAINING/norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303
----------[INFO] Output directory: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TESTING/clinical_deviations_norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303_20251102_150340
----------[INFO] Loaded model configuration from /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TRAINING/norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303/config.csv
----------[INFO] Using atlas: ['all']
----------[INFO] Using latent dimension: 20
----------[INFO] Using normative diagnosis: HC
----------[INFO] Using volume type: ['Vgm', 'G', 'T']
----------[INFO] Using valid volume types: ['Vgm', 'Vwm', 'Vcsf', 'G', 'T']
----------[INFO] Using clinical mri data path: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/CAT12_newvals/QC/CAT12_results_final.csv
----------[INFO] Using metadata CSV: ['/net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/data_training/test_metadataHC_0.720251101_1303.csv']
----------[INFO] Using device: cuda
----------[INFO] Loading clinical data...
----------[INFO] Loading test data from: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/data_training/test_metadataHC_0.720251101_1303.csv
----------[INFO] Using MRI data from: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/CAT12_newvals/QC/CAT12_results_final.csv
================================================================================
[INFO] Loading PRE-NORMALIZED MRI data
================================================================================
[INFO] Loading metadata from: ["['/net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/data_training/test_metadataHC_0.720251101_1303.csv']"]
[INFO] Loaded metadata with 2213 subjects
[INFO] Filtered to 2213 subjects with diagnoses: ['HC', 'MDD', 'SCHZ', 'CTT-SCHZ', 'CTT-MDD', 'BP', 'GenPop']
[INFO] Loading pre-normalized MRI data from: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/data_training/CAT12_results_NORMALIZED_columnwise_HC.csv
[INFO] Loaded MRI data with shape: (4163, 1211)
[INFO] Found 1194 ROI columns
[INFO]   - Vgm: 761 features
[INFO]   - G: 216 features
[INFO]   - T: 217 features
[INFO]   - Total: 1194 features
[INFO] Matching metadata subjects with MRI data...
[INFO] Successfully matched 2209/2213 subjects
[WARNING] 4 subjects not found in MRI data
[WARNING] Unmatched: ['sub-NDARINVTY904UNB_run01_T1w', 'sub-NDARINVGW978HUP_run01_T1w', 'sub-NDARINVHR360FAK_run01_T1w', 'sub-NDARINVLJ841ZFK_run01_T1w']
[INFO] Total subjects processed: 2209
[INFO] Total ROI features per subject: 1194
[INFO] Data loading complete!
================================================================================
----------[INFO] Clinical data shape: torch.Size([2209, 1194])
----------[INFO] Clinical data has 1194 features
----------[INFO] Annotations shape before filtering: 2213
----------[INFO] Clinical data subjects: 2209
----------[INFO] WARNING: Could not find subject ID column in annotations
----------[INFO] Available columns: ['Filename', 'Dataset', 'Diagnosis', 'Age', 'Sex', 'Sex_int', 'Co_Diagnosis', 'ICD10_Code', 'GAF_Score', 'PANSS_Positive', 'PANSS_Negative', 'PANSS_General', 'PANSS_Total', 'BPRS_Total', 'NCRS_Motor', 'NCRS_Affective', 'NCRS_Behavioral', 'NCRS_Total', 'NSS_Motor', 'NSS_Total']
----------[INFO] Fallback: Truncated annotations to first 2209 rows
----------[INFO] Annotations shape after filtering: 2209
----------[INFO] ✓ Annotations and clinical data are now aligned!
----------[INFO] Loading bootstrap models...
----------[INFO] Found 51 bootstrap models
----------[INFO] Models were trained with input_dim: 1194
----------[INFO] Loaded model: baseline_model.pt
----------[INFO] Loaded model: bootstrap_model_0.pt
----------[INFO] Loaded model: bootstrap_model_1.pt
----------[INFO] Loaded model: bootstrap_model_10.pt
----------[INFO] Loaded model: bootstrap_model_11.pt
----------[INFO] Loaded model: bootstrap_model_12.pt
----------[INFO] Loaded model: bootstrap_model_13.pt
----------[INFO] Loaded model: bootstrap_model_14.pt
----------[INFO] Loaded model: bootstrap_model_15.pt
----------[INFO] Loaded model: bootstrap_model_16.pt
----------[INFO] Loaded model: bootstrap_model_17.pt
----------[INFO] Loaded model: bootstrap_model_18.pt
----------[INFO] Loaded model: bootstrap_model_19.pt
----------[INFO] Loaded model: bootstrap_model_2.pt
----------[INFO] Loaded model: bootstrap_model_20.pt
----------[INFO] Loaded model: bootstrap_model_21.pt
----------[INFO] Loaded model: bootstrap_model_22.pt
----------[INFO] Loaded model: bootstrap_model_23.pt
----------[INFO] Loaded model: bootstrap_model_24.pt
----------[INFO] Loaded model: bootstrap_model_25.pt
----------[INFO] Loaded model: bootstrap_model_26.pt
----------[INFO] Loaded model: bootstrap_model_27.pt
----------[INFO] Loaded model: bootstrap_model_28.pt
----------[INFO] Loaded model: bootstrap_model_29.pt
----------[INFO] Loaded model: bootstrap_model_3.pt
----------[INFO] Loaded model: bootstrap_model_30.pt
----------[INFO] Loaded model: bootstrap_model_31.pt
----------[INFO] Loaded model: bootstrap_model_32.pt
----------[INFO] Loaded model: bootstrap_model_33.pt
----------[INFO] Loaded model: bootstrap_model_34.pt
----------[INFO] Loaded model: bootstrap_model_35.pt
----------[INFO] Loaded model: bootstrap_model_36.pt
----------[INFO] Loaded model: bootstrap_model_37.pt
----------[INFO] Loaded model: bootstrap_model_38.pt
----------[INFO] Loaded model: bootstrap_model_39.pt
----------[INFO] Loaded model: bootstrap_model_4.pt
----------[INFO] Loaded model: bootstrap_model_40.pt
----------[INFO] Loaded model: bootstrap_model_41.pt
----------[INFO] Loaded model: bootstrap_model_42.pt
----------[INFO] Loaded model: bootstrap_model_43.pt
----------[INFO] Loaded model: bootstrap_model_44.pt
----------[INFO] Loaded model: bootstrap_model_45.pt
----------[INFO] Loaded model: bootstrap_model_46.pt
----------[INFO] Loaded model: bootstrap_model_47.pt
----------[INFO] Loaded model: bootstrap_model_48.pt
----------[INFO] Loaded model: bootstrap_model_49.pt
----------[INFO] Loaded model: bootstrap_model_5.pt
----------[INFO] Loaded model: bootstrap_model_6.pt
----------[INFO] Loaded model: bootstrap_model_7.pt
----------[INFO] Loaded model: bootstrap_model_8.pt
----------[INFO] Loaded model: bootstrap_model_9.pt
----------[INFO] Successfully loaded 51 models
----------[INFO] 
================================================================================
----------[INFO] RUNNING PRE-TESTING DIAGNOSTICS
----------[INFO] ================================================================================
----------[INFO] ✓ Loaded baseline model for diagnostics

================================================================================
STARTING VAE DIAGNOSTICS
================================================================================

============================================================
Extracting latents for: HC
============================================================
----------[INFO] ⚠️  Warning: Could not complete diagnostics: not enough values to unpack (expected 3, got 2)
----------[INFO] Traceback (most recent call last):
  File "/net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/src/RUN_testing_normVAE2.py", line 347, in main
    hc_results, mdd_results = run_full_diagnostics(
                              ^^^^^^^^^^^^^^^^^^^^^
  File "/net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/src/diagnose_vae.py", line 560, in run_full_diagnostics
    hc_results = diagnostics.extract_latents_and_stats(hc_loader, group_name=hc_name)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/net/data.isilon/ag-cherrmann/lduttenhoefer/project/miniconda3/envs/LISA_ba_env/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/src/diagnose_vae.py", line 56, in extract_latents_and_stats
    for batch_idx, (measurements, labels, names) in enumerate(data_loader):
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ValueError: not enough values to unpack (expected 3, got 2)

----------[INFO] 
================================================================================
----------[INFO] STARTING COMBINED DEVIATION ANALYSIS
----------[INFO] Analyzing ALL 1194 features together (Vgm + G + T)
----------[INFO] ================================================================================

----------[INFO] 
================================================================================
----------[INFO] Computing MULTIPLE deviation score methods...
----------[INFO] ================================================================================
----------[INFO] 
[1/5] Calculating BOOTSTRAP deviation scores (original method)...
[INFO] Using 1194 ROI names for region columns
----------[INFO]    HC subjects in test set: 838
----------[INFO] 
[2/5] Computing D_MSE (Reconstruction-based)...
----------[INFO]    Range: [0.3642, 3.6795]
----------[INFO]    HC mean: 0.6921 ± 0.1665
----------[INFO] 
[3/5] Computing D_KL (KL Divergence)...
----------[INFO]    Range: [3.6891, 11.6850]
----------[INFO]    HC mean: 7.3131 ± 1.2309
----------[INFO] 
[4/5] Computing D_latent (Aguila et al. method)...
----------[INFO]    Range: [0.0453, 1.0440]
----------[INFO]    HC mean: 0.4389 ± 0.2098
----------[INFO] 
[5/5] Computing D_combined (weighted combination)...
----------[INFO]    Range: [0.0768, 0.7593]
----------[INFO]    HC mean: 0.2052 ± 0.0499
----------[INFO] 
✓ Adding all deviation methods to results DataFrame...
----------[INFO] ✓ All 5 deviation methods computed:
----------[INFO]    1. deviation_score (Bootstrap)
----------[INFO]    2. deviation_score_recon (D_MSE)
----------[INFO]    3. deviation_score_kl (D_KL)
----------[INFO]    4. deviation_score_latent_aguila (D_latent)
----------[INFO]    5. deviation_score_combined (Weighted)
----------[INFO] 
================================================================================
----------[INFO] CREATING ERRORBAR PLOTS FOR ALL 5 DEVIATION METRICS
----------[INFO] ================================================================================

[INFO] Creating errorbar plots (mean + median) for 7 deviation metrics...
       Total plots to create: 14

[INFO] Creating MEAN plots...
  ✓ Created: zscore_errorbar_mean_ctt_combined.png
  ✓ Created: percentile_errorbar_mean_ctt_combined.png
  ✓ Created: score_errorbar_mean_ctt_combined.png
  ✓ Created: recon_errorbar_mean_ctt_combined.png
  ✓ Created: kl_errorbar_mean_ctt_combined.png
  ✓ Created: latent_aguila_errorbar_mean_ctt_combined.png
  ✓ Created: combined_errorbar_mean_ctt_combined.png

[INFO] Creating MEDIAN plots...
  ✓ Created: zscore_errorbar_median_ctt_combined.png
  ✓ Created: percentile_errorbar_median_ctt_combined.png
  ✓ Created: score_errorbar_median_ctt_combined.png
  ✓ Created: recon_errorbar_median_ctt_combined.png
  ✓ Created: kl_errorbar_median_ctt_combined.png
  ✓ Created: latent_aguila_errorbar_median_ctt_combined.png
  ✓ Created: combined_errorbar_median_ctt_combined.png

[INFO] All 14 errorbar plots created!
       - 7 MEAN plots (error bars = SEM)
       - 7 MEDIAN plots (error bars = IQR)
----------[INFO] ✓ Created errorbar plots for all 5 deviation metrics
----------[INFO] 
================================================================================
----------[INFO] SAVING RESULTS
----------[INFO] ================================================================================

----------[INFO] Saved deviation scores (ALL methods) to: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TESTING/clinical_deviations_norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303_20251102_150340/deviation_scores_combined.csv
----------[INFO] Saved summary statistics to: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TESTING/clinical_deviations_norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303_20251102_150340/deviation_score_summary.csv
----------[INFO] 
================================================================================
----------[INFO] CREATING VISUALIZATIONS
----------[INFO] ================================================================================

----------[INFO] 
================================================================================
----------[INFO] REGIONAL DEVIATION ANALYSIS
----------[INFO] ================================================================================


[INFO] Starting MODIFIED regional deviation analysis...
[INFO] ROI names formatted for plotting. Example: [V] Neurom (RightAccumbensArea)
[INFO] Merged CTT-SCHZ and CTT-MDD into single CTT group
[INFO] Filtered to 4 main diagnoses: ['HC', 'MDD', 'SCHZ', 'CTT']
[INFO] Sample sizes after filtering:
       HC: 838
       MDD: 328
       SCHZ: 866
       CTT: 83
[INFO] Found 1194 regional z-score columns
[INFO] Analyzing MDD (n=328) vs HC (n=838)
[INFO] Analyzing SCHZ (n=866) vs HC (n=838)
[INFO] Analyzing CTT (n=83) vs HC (n=838)

[INFO] Creating paper-style plots (Top 16 per diagnosis)...
  ✓ Created paper-style plot for MDD
  ✓ Created paper-style plot for SCHZ
  ✓ Created paper-style plot for CTT

[INFO] Creating Heatmap 1 & 2...
[INFO] Selected top 30 CTT regions (n=1194 total)
[INFO] Selected top 30 overall regions

[INFO] Creating Heatmap 1: Top 30 CTT-affected regions (3 diagnoses)...
  ✓ Heatmap 1 created: 30 regions, 3 diagnoses

[INFO] Creating Heatmap 2: Top 30 overall-affected regions (3 diagnoses)...
  ✓ Heatmap 2 created: 30 regions, 3 diagnoses

[INFO] Regional deviation analysis finished.
----------[INFO] Saved regional effect sizes to: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TESTING/clinical_deviations_norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303_20251102_150340/regional_effect_sizes_combined.csv
----------[INFO] 
Top 20 ROIs with largest Cliff's Delta:
----------[INFO]                                 ROI_Name Diagnosis  Cliffs_Delta  Significant_Bootstrap_p05_uncorrected
              [T] Destrieux_rS (central)       CTT      0.499238                                   True
                       [V] IBSR (rVenDC)       CTT     -0.359548                                   True
                         [V] AAL3 (rREC)       CTT      0.356241                                   True
                        [V] AAL3 (ltPuA)       CTT     -0.353883                                   True
                      [V] AAL3 (lOFCmed)       CTT      0.348880                                   True
             [V] Sch100_rLimbicB_OFC (1)       CTT      0.346321                                   True
                      [V] lpba40 (lRecG)       CTT      0.334359                                   True
            [T] Destrieux_lS_front (inf)       CTT      0.333468                                   True
  [T] Destrieux_lG_temp_sup_G_T (transv)       CTT     -0.332691                                   True
             [V] Sch200_rLimbicB_OFC (1)       CTT      0.331426                                   True
                        [V] AAL3 (rtLGN)       CTT     -0.330650                                   True
        [V] Sch100_lLimbicA_TempPole (2)       CTT      0.328522                                   True
                        [V] AAL3 (rtPuM)       CTT     -0.318170                                   True
                        [V] AAL3 (rtMGN)       CTT     -0.313426                                   True
                       [V] AAL3 (RapheD)       CTT     -0.302930                                   True
          [T] DK40 (ltransversetemporal)       CTT     -0.297467                                   True
             [V] Sch200_lLimbicB_OFC (2)       CTT      0.297438                                   True
          [V] cobra (lSupPostCerebLVIIB)       CTT      0.287834                                   True
                       [V] lpba40 (rPut)      SCHZ      0.285280                                   True
[V] Neurom (RightMOrGMedialOrbitalGyrus)       CTT      0.283981                                   True
----------[INFO] 
================================================================================
----------[INFO] CORRELATION WITH CLINICAL VARIABLES
----------[INFO] ================================================================================

----------[INFO] 
================================================================================
----------[INFO] Visualizing latent space embeddings...
----------[INFO] ================================================================================

Generating embeddings...
Computing UMAP projection...
Creating visualization for column: Diagnosis
Creating visualization for column: Dataset
Creating visualization for column: Sex
Saved visualization for 'Diagnosis'
Saved visualization for 'Dataset'
Saved visualization for 'Sex'
----------[INFO] Saved latent space visualizations
----------[INFO] 
================================================================================
----------[INFO] TESTING COMPLETE - SUMMARY
----------[INFO] ================================================================================
----------[INFO] Main output directory: /net/data.isilon/ag-cherrmann/lduttenhoefer/project/VAE_model/analysis/TESTING/clinical_deviations_norm_results_HC_Vgm_G_T_all_columnwise_20251101_1303_20251102_150340
----------[INFO] 
Key outputs:
----------[INFO]   - deviation_scores_combined.csv (includes ALL 5 deviation methods)
----------[INFO]   - deviation_score_summary.csv
----------[INFO]   - regional_effect_sizes_combined.csv
----------[INFO] 
Plots:
----------[INFO]   Deviation distributions (figures/distributions/):
----------[INFO]     - score_errorbar_ctt_combined.png (Bootstrap)
----------[INFO]     - recon_errorbar_ctt_combined.png (Reconstruction)
----------[INFO]     - kl_errorbar_ctt_combined.png (KL Divergence)
----------[INFO]     - latent_aguila_errorbar_ctt_combined.png (Aguila method)
----------[INFO]     - combined_errorbar_ctt_combined.png (Combined)
----------[INFO]   Regional effect sizes (figures/):
----------[INFO]     - paper_style_SCHZ_vs_HC.png
----------[INFO]     - paper_style_MDD_vs_HC.png
----------[INFO]     - paper_style_CTT_vs_HC.png
----------[INFO]   Latent embeddings (figures/latent_embeddings/)
----------[INFO] ================================================================================


####################################################################################################

session completed at 2025-11-02 18:52:36.092710.

Configuration:
    __module__:          utils.config_utils_model
    __init__:            <function Config_2D.__init__ at 0x2b720ba5c720>
    __str__:             <function Config_2D.__str__ at 0x2b720ba5c7c0>
    __dict__:            <attribute '__dict__' of 'Config_2D' objects>
    __weakref__:         <attribute '__weakref__' of 'Config_2D' objects>
    __doc__:             None



    *      *  |    *
      *      / \     * 
    *    *  / _ \  *    *
           |.o '.|  *
      *    |'._.'|         done :) 
         * |     |  *   *
    *    ,'|  |  |`.   *
         / |  |  |  \    *
    *   |,-'--|--'-. |
    
    


